<div dir="rtl" align="right">

# زنجیر - پیام‌رسان امن و غیرمتمرکز بر پایه Matrix

<div align="center">

![زنجیر](https://img.shields.io/badge/زنجیر-v1.0.0-blue?style=for-the-badge)
![Matrix](https://img.shields.io/badge/Matrix-Protocol-green?style=for-the-badge)
![License](https://img.shields.io/badge/License-Apache%202.0-orange?style=for-the-badge)

**یک راه‌حل آماده برای بالا آوردن سرور Matrix شخصی**

</div>

---

## معرفی

زنجیر در واقع یک کانفیگ آماده و بسته‌بندی شده از پروتکل Matrix هست که کار رو راحت کرده. هدف اینه که بتونید سرور پیام‌رسان شخصی خودتون رو زیر ۵ دقیقه بالا بیارید، بدون اینکه درگیر کانفیگ‌های پیچیده بشید.

### ویژگی‌ها

- **کاملا فارسی** - رابط کاربری ۱۰۰٪ فارسی و راست‌چین
- **رمزنگاری سرتاسری** - پیام‌ها به صورت پیش‌فرض E2E رمزنگاری میشن
- **سبک و سریع** - بک‌اند روی Dendrite سوار شده، روی VPSهای ارزون هم خوب کار میکنه
- **نصب اینتراکتیو** - فقط اسکریپت رو اجرا کن، سوالاتش رو جواب بده
- **چندپلتفرمی** - کلاینت وب، موبایل و دسکتاپ داره
- **غیرمتمرکز** - دیتا دست خودتونه
- **SSL خودکار** - گواهی HTTPS رو اتوماتیک از Let's Encrypt میگیره

---

## پیش‌نیازها

### سخت‌افزار

برای شروع یه سرور خیلی معمولی هم کافیه:

| منبع | حداقل | پیشنهادی |
|------|-------|----------|
| CPU | 1 هسته | 2 هسته |
| RAM | 1 گیگابایت | 2 گیگابایت |
| دیسک | 10 گیگابایت | 20 گیگابایت |

### نرم‌افزار

- سیستم عامل: Ubuntu 22.04 یا 24.04
- یک دامنه با A Record به IP سرور (یا فقط IP برای حالت تستی)
- دسترسی root

---

## نصب

کل کار با سه خط انجام میشه:

```bash
git clone https://github.com/MatinSenPai/zanjir.git
cd zanjir
sudo bash install.sh
```

اسکریپت ازت سوال میپرسه:
1. آدرس سرور (دامنه یا IP)
2. ایمیل ادمین (فقط برای حالت دامنه، برای SSL لازمه)

بقیه کارا اتوماتیک انجام میشه: نصب Docker، تولید کلیدها، بالا آوردن سرویس‌ها، گرفتن SSL.

### حالت IP (بدون دامنه)

اگه فعلا دامنه نداری، میتونی با IP خالی هم بالا بیاری. فقط حواست باشه که این حالت SSL نداره و فقط برای تست مناسبه.

---

## ساخت کاربر

ثبت‌نام عمومی رو بستم که سرور اسپم نشه. برای ساخت یوزر:

```bash
docker exec -it zanjir-dendrite /usr/bin/create-account \
    --config /etc/dendrite/dendrite.yaml \
    --username نام_کاربری \
    --admin
```

بعدش ازت پسورد میخواد.

---

## استفاده

### وب

مرورگر رو باز کن و برو به آدرس سرورت. دکمه ورود رو بزن و با یوزری که ساختی لاگین کن.

### موبایل

1. اپ Element رو نصب کن (گوگل پلی یا اپ استور)
2. گزینه ورود رو بزن
3. حتما دکمه Edit کنار آدرس سرور رو بزن و آدرس خودت رو وارد کن
4. لاگین کن

### ساخت اتاق

دکمه + پایین صفحه، بعد "اتاق جدید". نام و تنظیمات پرایوسی رو انتخاب کن.

### رمزنگاری

چت‌های PV پیش‌فرض رمزنگاری شدن. برای گروه‌ها: تنظیمات اتاق، امنیت و حریم خصوصی، فعال‌سازی رمزنگاری.

---

## دستورات کاربردی

```bash
# وضعیت کانتینرها
docker compose ps

# لاگ‌ها
docker compose logs -f

# ریستارت
docker compose restart

# خاموش کردن
docker compose down

# آپدیت
docker compose pull
docker compose up -d
```

---

## حل مشکلات

### SSL صادر نمیشه

مشکل DNS داری. دستور `dig +short yourdomain.com` رو بزن، باید IP سرور رو برگردونه.
اگه تازه دامنه رو ست کردی، چند دقیقه صبر کن.

### صفحه لود نمیشه

فایروال رو چک کن:

```bash
sudo ufw allow 80
sudo ufw allow 443
```

### نمیتونم لاگین کنم

یوزر نساختی. بخش ساخت کاربر رو بخون.

### سرعت پایین

اگه سرور ایرانه، ممکنه اختلال باشه. از CDN (مثل ابرآروان) یا تانل استفاده کن.

### خطای Federation

پورت 8448 برای ارتباط با سرورهای دیگه Matrix استفاده میشه. اگه لازمش نداری، توی `dendrite/dendrite.yaml` غیرفعالش کن:

```yaml
global:
  disable_federation: true
```

---

## ساختار فایل‌ها

```
zanjir/
├── install.sh              # اسکریپت نصب
├── docker-compose.yml      # ارکستراسیون داکر
├── Caddyfile               # کانفیگ وب‌سرور (حالت دامنه)
├── Caddyfile.ip-mode       # کانفیگ وب‌سرور (حالت IP)
├── .env.example            # نمونه متغیرها
├── config/
│   ├── element-config.json # کانفیگ کلاینت وب
│   └── welcome.html        # صفحه لندینگ
├── dendrite/
│   └── dendrite.yaml       # کانفیگ سرور Matrix
└── scripts/
    └── generate-keys.sh    # تولید کلیدها
```

---

## امنیت و بکاپ

### نکات امنیتی

- پسورد قوی بذار
- فایل `.env` رو جایی منتشر نکن
- سرور رو آپدیت نگه دار

### بکاپ‌گیری

```bash
# دامپ دیتابیس
docker exec zanjir-postgres pg_dump -U dendrite dendrite > backup.sql

# آرشیو فایل‌ها
tar -czvf zanjir-backup.tar.gz dendrite/ config/ .env
```

---

## لایسنس

Apache 2.0

---

## کردیت

این پروژه بر پایه ابزارهای اوپن‌سورس زیر ساخته شده:

- [Matrix.org](https://matrix.org)
- [Dendrite](https://github.com/matrix-org/dendrite)
- [Element](https://element.io)
- [Caddy](https://caddyserver.com)

---

## پشتیبانی

مشکلی دیدی توی Issues گیت‌هاب مطرح کن.

<div align="center">

**تقدیم به بچه‌های خوب ایران**

</div>

</div>